<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SpectrumEye Login</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <header class="topbar">
        <a class="brand" href="/">codachrome</a>
        <nav aria-label="top nav">
            <a class="muted-link" href="/">Home</a>
        </nav>
    </header>

    <main>
        <section class="card form-card" aria-labelledby="login-title">
            <h2 id="login-title">SpectrumEye Login</h2>
            <p class="muted">Sign in to access your dashboard.</p>

            <label for="user">Username</label>
            <input id="user" type="text" placeholder="Username" required autocomplete="username">

            <label for="pass">Password</label>
            <input id="pass" type="password" placeholder="Password" required autocomplete="current-password">

            <div class="login-footer">
                <button class="btn" onclick="doLogin()">Login</button>
                <a class="secondary-link" href="#" onclick="alert('Contact admin to request access')">Need access?</a>
            </div>
        </section>
    </main>

    <script>
        async function doLogin() {
            const username = document.getElementById("user").value;
            const password = document.getElementById("pass").value;

            try {
                const res = await fetch("/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, password })
                });

                if (!res.ok) {
                    alert("Login request failed: " + res.status);
                    return;
                }

                const data = await res.json();

                if (data.success) {
                    // Server sets an HttpOnly cookie (session_token).
                    // For local development, also store the returned token as a
                    // fallback so the client-side guard on protected pages can
                    // detect a session. This is NOT secure and is only for dev.
                    if (data.token) {
                        try { localStorage.setItem('token', data.token); } catch (e) { /* ignore */ }
                    }

                    // Redirect to the protected dashboard page
                    window.location.href = '/dashboard/private.html';
                } else {
                    alert('Invalid username or password');
                }
            } catch (err) {
                console.error("Error logging in:", err);
                alert("An error occurred. Check the console.");
            }
        }
    </script>
</body>
</html>
