<!DOCTYPE html>
<html>
<head>
    <title>Spectrum Eye Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        // Verify session server-side first (reliable). If the server check
        // returns 401, redirect to login. If the check can't be reached
        // (network error), fall back to the localStorage token for dev.
        (async function () {
            try {
                const res = await fetch('/checksession', { method: 'GET', credentials: 'same-origin' });
                if (res.ok) {
                    // Session is valid — do nothing and allow the page to render.
                    return;
                }
                // Not authenticated — redirect to login
                window.location.href = '/dashboard/login.html';
            } catch (err) {
                // Fetch failed (likely local dev where functions aren't running).
                // Fall back to the client-side token saved by the login form.
                try {
                    const token = localStorage.getItem('token');
                    if (!token) {
                        window.location.href = '/dashboard/login.html';
                    }
                } catch (e) {
                    window.location.href = '/dashboard/login.html';
                }
            }
        })();
    </script>
</head>
<body>

<div id="header">
    <h2>Spectrum Eye Dashboard</h2>
    <div id="connection">● Connecting…</div>
</div>

<div id="container">

    <div id="sidebar">
        <button onclick="showPanel('system')">System Stats</button>
        <button onclick="showPanel('spectrum')">Spectrum</button>
        <button onclick="showPanel('commands')">Commands</button>
        <button onclick="showPanel('logs')">Logs</button>
    </div>

    <div id="main">
        <div id="panel-system" class="panel active">
            <h3>System Stats</h3>
            CPU: <span id="cpu"></span><br>
            RAM: <span id="ram"></span><br>
            Temp: <span id="temp"></span>
        </div>

        <div id="panel-spectrum" class="panel">
            <h3>Spectrum</h3>
            <canvas id="spectrumCanvas" width="600" height="200"></canvas>
        </div>

        <div id="panel-commands" class="panel">
            <h3>Command Runner</h3>
            <input id="cmd" placeholder="Enter command">
            <button onclick="sendCommand()">Run</button>
            <pre id="cmd-output"></pre>
        </div>

        <div id="panel-logs" class="panel">
            <h3>Logs</h3>
            <pre id="logs"></pre>
        </div>
    </div>

</div>

<script src="dashboard.js"></script>
</body>
</html>
