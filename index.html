<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>codachrome</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&family=Ubuntu:wght@400;700&display=swap"
        rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css"> 
    
    <style>
        /* Base styles */
        body {
            font-family: 'Ubuntu', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .glass #content-container {
            transition: filter 0.5s ease;
        }

        .blurred-background #content-container {
            filter: blur(5px);
            pointer-events: none; 
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.2);
            z-index: 10;
            overflow: hidden;
        }

        .overlay.is-active {
            display: block;
        }
        
        #scoreDisplay {
            z-index: 1003;
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 80px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            display: none; /* Hidden by default */
            pointer-events: none;
        }

        #countdown {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10vw;
            color: white;
            z-index: 11;
        }

        /* Bird / Logo Copy Styles */
        .game-mode #logo-copy {
            position: absolute; 
            cursor: pointer;
            left: 14px;
            top: 10px;
            white-space: nowrap; 
            display: inline-block; 
            z-index: 12; 
            line-height: 36px;
            text-align: center;
            overflow: hidden;
            
            /* Visual styles inherited from .brand */
            font-size: 1.1rem; 
            font-weight: 700;
            color: #e0e2e7;
            background: linear-gradient(#4b4e55, #393c42); 
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.15);
            border-radius: 8px; /* Added for consistency */
        }
        
        /* Ensure original logo is clickable during game for reset */
        .game-mode #logo {
            pointer-events: auto !important; 
            position: relative; 
            z-index: 1002; 
        }

        .obstacle {
            position: absolute;
            width: 80px; 
            background-color: #4CAF50; 
            border: 2px solid #333;
        }
        
        .game-mode {
            overflow-x: hidden; 
        }
    </style>
</head>

<body class="glass">
    
    <div id="countdown"></div>
    <div class="overlay" id="gameOverlay">
        <div id="scoreDisplay">0</div>
    </div>
    
    <div id="content-container">
    
        <header class="topbar" role="banner">
            <img src="/images/LOGOWITHBG2.png" class="brand" id="logo" aria-label="codachrome home">
            <nav role="navigation" aria-label="Main navigation">
                <ul class="nav-list" role="menubar">
                    <li role="none"><a href="#" role="menuitem" class="tab-link active" data-target="home" data-link-type="nav">Home</a></li>
                    <li role="none"><a href="#" role="menuitem" class="tab-link" data-target="projects" data-link-type="nav">Projects</a></li>
                    <li role="none"><a href="#" role="menuitem" class="tab-link" data-target="more" data-link-type="nav">More</a></li>
                    <li role="none"><a href="#" role="menuitem" class="tab-link" data-target="dashboard" data-link-type="nav">Dashboard</a></li>
                </ul>
            </nav>
        </header>
        
        <main>
            <div class="home-layout">
                <section id="home" class="card tab-panel" role="region" aria-labelledby="home-tab" style="display:block">
                    <h1>Welcome</h1>
                    <p>This is the home tab. Click "Projects" to see my work.</p>
                    <h2>Contact</h2>
                    <div class="contact-links">
                        <img src="/images/backgroundremovedgitlogo.png" alt="GitHub Icon" class="contact-icon" href="github.com/C0dachrome">
                        <img src="/images/linkedin logo.png" alt="LinkedIn Icon" class="contact-icon" href="linkedin.com/in/cody-milward-3b4bba240">
                        <img src="/images/email logo.png" alt="Email Icon" class="contact-icon" href="mailto:codycmillward@gmail.com">
                    </div>
                </section>
                <aside class="home-commits">
                    <h2>Latest Site Commits</h2>
                    <ul id="homeCommitList" class="commit-list"></ul>
                </aside>
            </div>
            
            <section id="projects" class="card tab-panel" role="region" aria-labelledby="projects-tab" style="display:none">
                <h1>Projects</h1>
                <p></p>
                <div class="project-grid">
                    <div class="project-card">
                        <h2>WARP</h2>
                        <p>Web Authentication and Rewrite Proxy</p>
                        <div class="project-links"><a href="prxy.html" class="btn">Project Page</a></div>
                    </div>
                    <br>
                    <div class="project-card">
                        <h2>SpectrumEye</h2>
                        <p>Portable, powerful RF analysis device</p>
                        <div class="project-links"><a href="/projects/speceye.html" class="btn">Project Page</a></div>
                    </div>
                    <br>
                    <div class="project-card">
                        <h2>CM-R1</h2>
                        <p>Compact FMCW radar</p>
                        <div class="project-links"><a href="/projects/cmr1.html" class="btn">Project Page</a></div>
                    </div>
                </div>
            </section>
            
            <section id="more" class="card tab-panel" role="region" aria-labelledby="more-tab" style="display:none">
                <h1>More</h1>
                <p></p>
                <div class="tabs" aria-hidden="false">
                    <a class="btn" href="prxy.html" role="button" aria-label="Go to WARP page">WARP</a>
                </div>
            </section>
            
            <section id="dashboard" class="card tab-panel" role="region" aria-labelledby="dashboard-tab" style="display:none">
                <h1>Dashboard Login</h1>
                <p></p>
                <a class="btn" href="dashboard/login.html" role="button" aria-label="Go to Dashboard login page">Login</a>
            </section>
        </main>
    </div>

    <script>
        const logo = document.getElementById('logo');
        const overlay = document.getElementById('gameOverlay');
        const countdownEl = document.getElementById('countdown');
        const scoreDisplay = document.getElementById('scoreDisplay'); // Added Score Element
        const body = document.body;
        const contentContainer = document.getElementById('content-container');

        // Global Variables
        let logoCopy; 
        
        // Game State
        let gameState = 'waiting'; // 'waiting', 'counting', 'playing', 'gameOver'
        let gameLoopId;
        let obstacleIntervalId;
        
        // Physics & Dimensions
        let velocity = 0;
        const gravity = 0.5;
        let positionY = 0; // FIX: Declared only once now
        let elementHeight;
        let elementWidth;
        let groundLevel;

        // Ragdoll Physics
        let angularVelocity = 0; 
        let rotation = 0;        
        const angularDrag = 0.9; 
        const bounceFactor = 0.6; 

        // Obstacles & Score
        const OBSTACLE_WIDTH = 80;
        const PIPE_GAP = 200; 
        const OBSTACLE_SPEED = 5; 
        let obstacles = [];
        let score = 0; 
        const logoRectInitialX = 14; // Matches CSS left: 14px

        // --- Event Listeners ---

        // Unified Logo Click Listener (Handles Start and Reset)
        logo.addEventListener('click', (e) => {
            e.preventDefault(); 
            if (gameState === 'waiting') {
                initializeGame();
            } else if (gameState === 'playing' || gameState === 'gameOver') {
                resetGame();
            }
        });

        // Bind nav links to reset
        document.querySelectorAll('a[data-link-type="nav"]').forEach(link => {
            link.addEventListener('click', resetGame);
        });

        // --- Game Logic ---

        function initializeGame() {
            if (gameState !== 'waiting') return;

            gameState = 'counting';
            body.classList.add('blurred-background', 'game-mode');
            overlay.classList.add('is-active');
            countdownEl.style.display = 'block';

            // Create clone
            logoCopy = logo.cloneNode(true); 
            logoCopy.id = 'logo-copy'; 
            overlay.appendChild(logoCopy);
            
            // Set initial inline styles
            logoCopy.style.position = 'absolute'; 
            logoCopy.style.top = '10px';
            logoCopy.style.left = '14px';
            
            // Allow clicking the bird to reset if dead/playing
            logoCopy.addEventListener('click', (e) => {
                e.preventDefault(); 
                if (gameState === 'playing' || gameState === 'gameOver') {
                    resetGame();
                }
            });

            startCountdown();
        }

        function resetGame() {
            if (gameState === 'waiting') return;
            
            // Remove DOM elements
            if (logoCopy) logoCopy.remove();
            obstacles.forEach(o => {
                o.elementTop.remove();
                o.elementBottom.remove();
            });
            obstacles = [];

            // Clear Loops
            clearInterval(obstacleIntervalId);
            cancelAnimationFrame(gameLoopId);
            document.removeEventListener('keydown', handleKeyPress);
            window.removeEventListener('resize', updateGroundLevel);

            // Reset UI
            body.classList.remove('blurred-background', 'game-mode');
            overlay.classList.remove('is-active');
            countdownEl.style.display = 'none';
            scoreDisplay.style.display = 'none'; // Hide Score

            // Reset Logic
            gameState = 'waiting';
            velocity = 0;
            positionY = 0;
            score = 0;
            rotation = 0; 
            angularVelocity = 0;
        }

        function startCountdown() {
            let count = 3;
            countdownEl.textContent = count;

            const timer = setInterval(() => {
                count--;
                countdownEl.textContent = count;

                if (count === 0) {
                    clearInterval(timer);
                    countdownEl.style.display = 'none';
                    startGameLoop();
                }
            }, 1000);
        }

        function startGameLoop() {
            gameState = 'playing';
            
            // Score Reset
            score = 0;
            scoreDisplay.textContent = score;
            scoreDisplay.style.display = 'block';

            // Dimensions
            elementHeight = logoCopy.offsetHeight;
            elementWidth = logoCopy.offsetWidth;
            
            updateGroundLevel();
            window.addEventListener('resize', updateGroundLevel);
            
            document.addEventListener('keydown', handleKeyPress);
            
            // Start Obstacles
            obstacleIntervalId = setInterval(createObstacle, 2500); 

            gameLoopId = requestAnimationFrame(render);
        }

        function updateGroundLevel() {
            groundLevel = window.innerHeight - elementHeight - 20; 
        }

        function handleKeyPress(event) {
            if (event.keyCode === 32 && gameState === 'playing') {
                event.preventDefault(); 
                velocity = -10; 
            }
        }

        function render() {
            if (gameState !== 'playing') return;

            // Physics
            velocity += gravity;    
            positionY += velocity;

            // Floor Check
            if (positionY >= groundLevel) {
                positionY = groundLevel;    
                velocity = 0;   
                gameOver();
                return;
            } else if (positionY < 0) {
                positionY = 0; 
                velocity = 0;
            }

            // Move Bird
            logoCopy.style.transform = `translateY(${positionY}px)`;

            // Move Obstacles
            moveObstacles();
            
            // Collisions
            if (checkCollisions()) {
                gameOver();
                return; 
            }

            gameLoopId = requestAnimationFrame(render);
        }

        function gameOver() {
            if (gameState === 'gameOver') return;
            gameState = 'gameOver';
            
            clearInterval(obstacleIntervalId);
            
            // Init Ragdoll Physics
            velocity = 6; 
            angularVelocity = (Math.random() < 0.5 ? -1 : 1) * (15 + Math.random() * 15);
            
            gameLoopId = requestAnimationFrame(tumbleLoop);
        }
        
        function tumbleLoop() {
            if (gameState !== 'gameOver') return;

            // Ragdoll Physics
            velocity += gravity;
            positionY += velocity;
            rotation += angularVelocity;
            angularVelocity *= angularDrag; 

            // Floor Bounce
            if (positionY >= groundLevel) {
                positionY = groundLevel;
                velocity *= -bounceFactor; 
                angularVelocity *= -bounceFactor; 
                
                if (Math.abs(velocity) < 1) velocity = 0;
                if (Math.abs(angularVelocity) < 0.5) angularVelocity = 0;
            }
            
            logoCopy.style.transform = `translateY(${positionY}px) rotate(${rotation}deg)`;

            // Stop loop when still
            if (positionY === groundLevel && velocity === 0 && angularVelocity === 0) {
                 return;
            }

            gameLoopId = requestAnimationFrame(tumbleLoop);
        }

        function createObstacle() {
            const minHeight = 50;
            const maxHeight = window.innerHeight - PIPE_GAP - minHeight;
            const topHeight = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;
            const bottomHeight = window.innerHeight - topHeight - PIPE_GAP;

            const topPipe = document.createElement('div');
            topPipe.classList.add('obstacle');
            topPipe.style.height = `${topHeight}px`;
            topPipe.style.top = '0px';
            topPipe.style.left = `${window.innerWidth}px`;

            const bottomPipe = document.createElement('div');
            bottomPipe.classList.add('obstacle');
            bottomPipe.style.height = `${bottomHeight}px`;
            bottomPipe.style.bottom = '0px';
            bottomPipe.style.left = `${window.innerWidth}px`; 

            overlay.appendChild(topPipe);
            overlay.appendChild(bottomPipe);

            obstacles.push({
                elementTop: topPipe,
                elementBottom: bottomPipe,
                x: window.innerWidth,
                passed: false // Scoring flag
            });
        }

        function moveObstacles() {
            for (let i = 0; i < obstacles.length; i++) {
                const obstacle = obstacles[i];
                obstacle.x -= OBSTACLE_SPEED;

                obstacle.elementTop.style.left = `${obstacle.x}px`;
                obstacle.elementBottom.style.left = `${obstacle.x}px`;

                if (obstacle.x + OBSTACLE_WIDTH < 0) {
                    obstacle.elementTop.remove();
                    obstacle.elementBottom.remove();
                    obstacles.splice(i, 1);
                    i--; 
                }
            }
        }

        function checkCollisions() {
            const logoRect = logoCopy.getBoundingClientRect();
            // Calculate X position of bird's right edge for scoring
            const logoRightEdge = logoRectInitialX + elementWidth; 

            for (const obstacle of obstacles) {
                const topRect = obstacle.elementTop.getBoundingClientRect();
                const bottomRect = obstacle.elementBottom.getBoundingClientRect();

                // Collision Logic
                if (
                    logoRect.right > topRect.left &&
                    logoRect.left < topRect.right &&
                    logoRect.bottom > topRect.top &&
                    logoRect.top < topRect.bottom
                ) return true;

                if (
                    logoRect.right > bottomRect.left &&
                    logoRect.left < bottomRect.right &&
                    logoRect.bottom > bottomRect.top &&
                    logoRect.top < bottomRect.bottom
                ) return true;
                
                // Scoring Logic
                if (obstacle.x + OBSTACLE_WIDTH < logoRightEdge && !obstacle.passed) {
                    score++;
                    scoreDisplay.textContent = score;
                    obstacle.passed = true;
                }
            }
            return false;
        }

    </script>
</body>
</html>
